<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>画像合成</title>
    <link rel="stylesheet" href="main.css">
</head>
<header></header>
<main>
    <h2>画像をアップロードして合成しよう(*ﾟ∀ﾟ*) </h2>
    <form>
        <input type="file" name="image_file_up" accept=".jpeg,.png,.jpg">
        <button type="submit">OK</button>

    </form>

</main>

<body>
    <!-- 以下スクリプト -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src='https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js'></script>
    <script src='https://www.gstatic.com/firebasejs/9.13.0/firebase-storage.js'></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAQaQO9rJmvg4zcryHftugUDaaBkzDQB7g",
            authDomain: "hana-app-511e7.firebaseapp.com",
            projectId: "hana-app-511e7",
            storageBucket: "hana-app-511e7.appspot.com",
            messagingSenderId: "464200535528",
            appId: "1:464200535528:web:e161becf16365f654d285d"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        //formのsubmitにイベント設定
        var form = document.querySelector('form');
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            var imgs = form.querySelector('input');
            var uploads = [];
            for (var file of imgs.files) {
                //選択したファイルのファイル名を使うが、場合によってはかぶるので注意
                var storageRef = firebase.storage().ref('form-uploaded/' + file.name);
                uploads.push(storageRef.put(file));
            }
            //すべての画像のアップロード完了を待つ
            Promise.all(uploads).then(function () {
                console.log('アップロード完了');
            });
        });

    </script>
</body>

</html>